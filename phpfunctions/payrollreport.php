<?php/** * Created by Shafeek Ajmal. */$config=parse_ini_file(__DIR__."/../jsheetconfig.ini");if(!isset($_SESSION)){    session_name($config['sessionName']);    session_start();}require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/phpfunctions/organizationUser.php");require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/query/payrollreport.php");//require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/phpfunctions/payroll.php");function dropdownlistPayrollSearchStaff(){    $con=connectDb();    $status=1;    $role=42;    $isStaff = 1;    $orgId=$_SESSION['orgId'];    $staff=fetchOrganizationStaffListIfIsStaff($con,$orgId,$isStaff,$status);    echo "<select name='orgStaffId' class='form-control' id='orgStaffId' >";    echo "<option value='0' >All Staff</option>\n";    foreach ($staff as $data){        echo "<option value=".$data['id']." >".$data['name']." [ ".$data['staffId']." ]"."</option>";    }    echo	"</select>";}if (isset($_POST['payrollReportGenerate'])) {    $timeCategory = $_POST['timeCategory'];    $datesearch="";    $salary="";    $allowance="";    $commissions="";    $claims="";    $bonus="";    $ot="";    $epf="";    $socso="";    $pcb="";    if($timeCategory){$datesearch=$_POST['dateYear'];}    else{$datesearch=$_POST['dateMonth'];}    $staffid=$_POST['orgStaffId'];    if(isset($_POST['salary'])){    $salary=",salaryMonth";}    if(isset($_POST['allowance'])){    $allowance=",allowance";}    if(isset($_POST['commissions'])){    $commissions=",commissions";}    if(isset($_POST['claims'])){    $claims=",claims";}    if(isset($_POST['bonus'])){        $bonus=",bonus";}    if(isset($_POST['ot'])){    $ot=",ot";}    if(isset($_POST['epf'])){        $epf=",epf";}    if(isset($_POST['socso'])){            $socso=",socso";}    if(isset($_POST['pcb'])){                $pcb=",pcb";}    $query="";    if($staffid==0) {        $query = "SELECT staffName" . $salary . "" . $allowance . "" . $commissions . "" . $claims . "" . $bonus ."" . $ot ."" . $epf ."" . $socso ."" . $pcb . ",netPay FROM payslip WHERE datePayment LIKE '" . $datesearch . "%'";    }else{        $query="SELECT staffName".$salary."".$allowance."".$commissions."".$claims."".$bonus ."" .$ot."" . $epf ."" . $socso ."" . $pcb .",netPay FROM payslip WHERE datePayment LIKE '".$datesearch."%' AND staffId=".$staffid."";    }    $con=connectDb();    $reportDetails=fetchPayrollReportList($con,$query);    $table='<table  id="payrollreport" class="display" style="width:100%"><thead><tr><th>NO</th>'.        '<th>Staff Name</th>';        $headcount=3;    if(isset($_POST['salary'])){        $table=$table.'<th>Salary</th>';$headcount++;}    if(isset($_POST['allowance'])){        $table=$table.'<th>Allowance</th>';$headcount++;}    if(isset($_POST['commissions'])){        $table=$table.'<th>Commissions</th>';$headcount++;}    if(isset($_POST['claims'])){        $table=$table.'<th>Claims</th>';$headcount++;}    if(isset($_POST['bonus'])){        $table=$table.'<th>Bonus</th>';$headcount++;}    if(isset($_POST['ot'])){        $table=$table.'<th>OT</th>';$headcount++;}    if(isset($_POST['epf'])){        $table=$table.'<th>EPF</th>';$headcount++;}    if(isset($_POST['socso'])){        $table=$table.'<th>SOCSO</th>';$headcount++;}    if(isset($_POST['pcb'])){        $table=$table.'<th>PCB</th>';$headcount++;}        $table=$table.'<th>Net Salary</th></tr></thead>';$rowscount=0;    $rownum=1;    $table=$table.'<tbody>';    $salarycount=0;    foreach ($reportDetails as $data){        $table=$table.'<tr><td>'.$rownum.'</td><td>'.$data['staffName'].'</td>';        if(isset($_POST['salary'])){            $table=$table.'<td>'.$data['salaryMonth'].'</td>';}        if(isset($_POST['allowance'])){            $table=$table.'<td>'.$data['allowance'].'</td>';}        if(isset($_POST['commissions'])){            $table=$table.'<td>'.$data['commissions'].'</td>';}        if(isset($_POST['claims'])){            $table=$table.'<td>'.$data['claims'].'</td>';}        if(isset($_POST['bonus'])){            $table=$table.'<td>'.$data['bonus'].'</td>';}        if(isset($_POST['ot'])){            $table=$table.'<td>'.$data['ot'].'</td>';}        if(isset($_POST['epf'])){            $table=$table.'<td>'.$data['epf'].'</td>';}        if(isset($_POST['socso'])){            $table=$table.'<td>'.$data['socso'].'</td>';}        if(isset($_POST['pcb'])){            $table=$table.'<td>'.$data['pcb'].'</td>';}        $table=$table.'<td>'.$data['netPay'].'</td>';        $table=$table.'</tr>';                $salarycount=$salarycount+floatval(str_replace(",","",$data['netPay']));        $rowscount++;        $rownum++;       // echo "<option value=".$data['id']." >".$data['name']." [ ".$data['staffId']." ]"."</option>";    }   // $table=$table.'<tr><td colspan="'.$headcount.'" style="text-align:center">Total Salary: '.number_format($salarycount,2).'</td></tr>';    $table=$table.'</tbody></table>';    //file_put_contents("./payroll.log",print_r($reportDetails,true));    if($rowscount==0){$table="<center><h3 style=\"color:#555;\">No Record Found</h3></center>";}    $_SESSION['total']=$salarycount;    $_SESSION['datesearch']=$datesearch;    $_SESSION['payrollTable'] = $table;    $_SESSION['payrollTableExport'] = $table;    header("Location:  https://".$_SERVER['HTTP_HOST'].$config['appRoot']."/organization/payroll/payrollreport.php");}?>