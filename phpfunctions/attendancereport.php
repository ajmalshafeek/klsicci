<?php/** * Created by Shafeek Ajmal. */$config=parse_ini_file(__DIR__."/../jsheetconfig.ini");if(!isset($_SESSION)){    session_name($config['sessionName']);    session_start();}require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/phpfunctions/organizationUser.php");require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/query/attendancereport.php");//require_once($_SERVER['DOCUMENT_ROOT'].$config['appRoot']."/phpfunctions/payroll.php");function dropdownlistPayrollSearchStaff(){    $con=connectDb();    $status=1;    $role=42;    $isStaff = 1;    $orgId=$_SESSION['orgId'];    $staff=fetchOrganizationStaffListIfIsStaff($con,$orgId,$isStaff,$status);    echo "<select name='orgStaffId' class='form-control' id='orgStaffId' >";    echo "<option value='0' >All Staff</option>\n";    foreach ($staff as $data){        echo "<option value=".$data['id']." >".$data['name']." [ ".$data['staffId']." ]"."</option>";    }    echo	"</select>";}if (isset($_POST['attendanceReportGenerate'])) {    $timeCategory = $_POST['timeCategory'];    $datesearch="";	$date="";	$countAttendance=0;	if(isset($_POST['countAttendance'])){		$countAttendance =$_POST['countAttendance'];	}    if($timeCategory==1){$datesearch=$_POST['dateYear'];}    elseif($timeCategory==2){$datesearch=$_POST['dateSingle'];}    else{$datesearch=$_POST['dateMonth'];}    $staffid=$_POST['orgStaffId'];    $query="";    if($staffid==0) {	    $query = 'SELECT o.name, o.staffId, o.id,  DATE_FORMAT(a.checkinTime,"%y/%m/%d %H:%i") AS "checkin",DATE_FORMAT(a.checkoutTime,"%y/%m/%d %H:%i") AS "checkout"FROM attendance AS a RIGHT JOIN organizationuser AS o ON a.staffId=o.id WHERE a.checkinTime like "' . $datesearch . '%" ORDER BY a.staffId';     }else{	    $query = 'SELECT o.name, o.staffId, o.id,  DATE_FORMAT(a.checkinTime,"%y/%m/%d %H:%i") AS "checkin",DATE_FORMAT(a.checkoutTime,"%y/%m/%d %H:%i") AS "checkout"FROM attendance AS a RIGHT JOIN organizationuser AS o ON a.staffId=o.id WHERE a.staffId=' . $staffid . ' AND a.checkinTime like "' . $datesearch . '%" ORDER BY a.staffId;';	}    $con=connectDb();    $reportDetails=fetchAttendanceReportList($con,$query);    $table='<table  id="attendancereport" class="display" style="width:100%"><thead><tr><th>NO</th>'.        '<th>Staff Name</th>';        $headcount=3;        $table=$table.'<th>Staff ID</th>';	if($countAttendance==0){		$table=$table.'<th>Check In</th>';		$table=$table.'<th>Check Out</th>';	}else{		$table=$table.'<th>Attendance</th>';	}		$table=$table.'</tr></thead>';    $rowscount=0;    $rownum=1;    $table=$table.'<tbody>';    $salarycount=0;	$staffcount=1;	$tempStaff=0;	$tempCount=0;    foreach ($reportDetails as $data){	if($countAttendance==0){		$table=$table.'<tr><td>'.$rownum.'</td><td>'.$data['name'].'</td>';		$table=$table.'<td>'.$data['staffId'].'</td>';		$table=$table.'<td>'.$data['checkin'].'</td>';		$table=$table.'<td>'.$data['checkout'].'</td>';		$table=$table.'</tr>';		$rowscount++;		$rownum++;	}elseif($countAttendance==3){		if($tempCount==0){			$table=$table.'<tr><td>'.$rownum.'</td><td>'.$data['name'].'</td>';			$table=$table.'<td>'.$data['staffId'].'</td>';			$table=$table.'<td>';			$tempCount=$tempCount+1;			$rownum++;		}else {			if ($tempStaff == $data['id']) {				$staffcount = $staffcount + 1;			} elseif ($tempStaff != $data['id']) {					$table = $table . "" . $staffcount ;					$table = $table . '</td>';					$table = $table . '</tr>';					$table = $table . '<tr><td>' . $rownum . '</td><td>' . $data['name'] . '</td>';					$table = $table . '<td>' . $data['staffId'] . '</td>';					$table = $table . '<td>';					$tempCount = 2;					$staffcount = 1;				$rownum++;			}			$rowscount++;		}	}	    $tempStaff=$data['id'];    }		$table=$table."".$staffcount;		$table=$table.'</td>';		$table=$table.'</tr>';	 $table=$table.'</tbody></table>';    if($rowscount==0){$table="<center><h3 style=\"color:#555;\">No Record Found</h3></center>";}    $_SESSION['datesearch']=$datesearch;    $_SESSION['attendanceTable'] = $table;    $_SESSION['attendanceTableExport'] = $table;    header("Location:  https://".$_SERVER['HTTP_HOST'].$config['appRoot']."/organization/attendance/attendancereport.php");}?>